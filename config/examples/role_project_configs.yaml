# =====================================================================
# Example Role-Project Assignment Configurations
# =====================================================================
# This file demonstrates the Groups → Roles → Projects workflow for
# implementing granular and reusable ACLs in Braintrust.
#
# The workflow enables:
# 1. Groups are assigned to roles (collections of permissions)
# 2. Roles are assigned to specific projects via ACLs
# 3. Changes to roles automatically apply to all assigned groups/projects
# =====================================================================

# ---------------------------------------------------------------------
# EXAMPLE 1: Basic Role-Project Workflow
# ---------------------------------------------------------------------
# Standard setup with common roles and simple project assignments
basic_workflow:
  role_project_assignment:
    global_config:
      # ========== Standard Roles Management ==========
      # Define roles that should exist in all Braintrust organizations
      standard_roles:
        # Full administrative access
        - name: "Admin"
          description: "Full administrative access including ACL management"
          member_permissions:
            - permission: "create"
              restrict_object_type: null
            - permission: "read"
              restrict_object_type: null
            - permission: "update"
              restrict_object_type: null
            - permission: "delete"
              restrict_object_type: null
            - permission: "create_acls"
              restrict_object_type: null
            - permission: "read_acls"
              restrict_object_type: null
            - permission: "update_acls"
              restrict_object_type: null
            - permission: "delete_acls"
              restrict_object_type: null
        
        # Standard engineering role
        - name: "Engineer"
          description: "Standard engineering permissions - CRUD without ACL management"
          member_permissions:
            - permission: "create"
              restrict_object_type: null
            - permission: "read"
              restrict_object_type: null
            - permission: "update"
              restrict_object_type: null
            - permission: "delete"
              restrict_object_type: null
        
        # Data science focused role
        - name: "DataScientist"
          description: "Data science permissions - read all, modify experiments/datasets"
          member_permissions:
            - permission: "read"
              restrict_object_type: null
            - permission: "create"
              restrict_object_type: "experiment"
            - permission: "create"
              restrict_object_type: "dataset"
            - permission: "update"
              restrict_object_type: "experiment"
            - permission: "update"
              restrict_object_type: "dataset"
            - permission: "delete"
              restrict_object_type: "experiment"
            - permission: "delete"
              restrict_object_type: "dataset"
        
        # Read-only access
        - name: "Viewer"
          description: "Read-only access to all content"
          member_permissions:
            - permission: "read"
              restrict_object_type: null
      
      # Role management settings
      auto_create_roles: true
      update_existing_roles: false
      
      # ========== Group → Role → Project Assignments ==========
      group_assignments:
        # Engineering team gets Engineer role on all ML projects
        - group_name: "Engineering"
          role_name: "Engineer"
          project_match:
            name_pattern: "(?i).*(ml|machine.learning|model).*"
          enabled: true
          priority: 10
        
        # Data Science team gets DataScientist role on data projects
        - group_name: "DataScience"
          role_name: "DataScientist"
          project_match:
            name_contains: ["data", "analytics", "research"]
          enabled: true
          priority: 10
        
        # Admins get Admin role on all projects
        - group_name: "Admins"
          role_name: "Admin"
          project_match:
            all_projects: true
          enabled: true
          priority: 100  # Highest priority
        
        # Everyone gets Viewer role on public projects
        - group_name: "AllEmployees"
          role_name: "Viewer"
          project_match:
            name_starts_with: "public-"
          enabled: true
          priority: 1  # Lowest priority
      
      # Safety settings
      remove_unmanaged_acls: false
      dry_run: false

# ---------------------------------------------------------------------
# EXAMPLE 2: Advanced Project Matching
# ---------------------------------------------------------------------
# Demonstrates sophisticated project matching rules
advanced_matching:
  role_project_assignment:
    global_config:
      # Use a subset of standard roles
      standard_roles:
        - name: "ProjectManager"
          description: "Project management with team assignment capabilities"
          member_permissions:
            - permission: "create"
              restrict_object_type: null
            - permission: "read"
              restrict_object_type: null
            - permission: "update"
              restrict_object_type: null
            - permission: "delete"
              restrict_object_type: null
            - permission: "create_acls"
              restrict_object_type: "project"
            - permission: "read_acls"
              restrict_object_type: "project"
            - permission: "update_acls"
              restrict_object_type: "project"
        
        - name: "Developer"
          description: "Development permissions for specific project types"
          member_permissions:
            - permission: "read"
              restrict_object_type: null
            - permission: "create"
              restrict_object_type: "experiment"
            - permission: "update"
              restrict_object_type: "experiment"
      
      auto_create_roles: true
      update_existing_roles: true
      
      group_assignments:
        # Complex regex matching for different project types
        - group_name: "FrontendTeam"
          role_name: "Developer"
          project_match:
            name_pattern: "^(web|ui|frontend|app|mobile)[-_].*"
            exclude_patterns:
              - ".*-archive$"
              - ".*-deprecated$"
          enabled: true
          priority: 5
        
        # Multiple project selection methods
        - group_name: "BackendTeam"
          role_name: "Developer"
          project_match:
            name_contains: ["api", "service", "backend"]
            exclude_patterns: ["test-.*", ".*-temp"]
          enabled: true
          priority: 5
        
        # Specific project list
        - group_name: "SecurityTeam"
          role_name: "ProjectManager"
          project_match:
            project_names:
              - "Security Audit Platform"
              - "Authentication Service"
              - "Compliance Dashboard"
          enabled: true
          priority: 15
        
        # Pattern with string matching combinations
        - group_name: "MLOpsTeam"
          role_name: "ProjectManager"
          project_match:
            name_pattern: "(?i).*(mlops|ml-platform|model-deploy).*"
            name_ends_with: "-prod"
          enabled: true
          priority: 20

# ---------------------------------------------------------------------
# EXAMPLE 3: Multi-Organization Configuration
# ---------------------------------------------------------------------
# Different role-project setups for different Braintrust organizations
multi_org_setup:
  role_project_assignment:
    # Global fallback configuration
    global_config:
      standard_roles:
        - name: "BasicUser"
          description: "Basic user permissions"
          member_permissions:
            - permission: "read"
              restrict_object_type: null
            - permission: "create"
              restrict_object_type: "experiment"
      
      group_assignments:
        - group_name: "AllUsers"
          role_name: "BasicUser"
          project_match:
            all_projects: true
          enabled: true
          priority: 1
      
      auto_create_roles: true
      update_existing_roles: false
    
    # Organization-specific configurations
    org_configs:
      # Production org - strict permissions
      - braintrust_org: "production"
        enabled: true
        role_project_config:
          standard_roles:
            - name: "ProdEngineer"
              description: "Production engineer with limited permissions"
              member_permissions:
                - permission: "read"
                  restrict_object_type: null
                - permission: "create"
                  restrict_object_type: "experiment"
                - permission: "update"
                  restrict_object_type: "experiment"
            
            - name: "ProdAdmin"
              description: "Production administrator"
              member_permissions:
                - permission: "create"
                  restrict_object_type: null
                - permission: "read"
                  restrict_object_type: null
                - permission: "update"
                  restrict_object_type: null
                - permission: "create_acls"
                  restrict_object_type: "project"
                - permission: "read_acls"
                  restrict_object_type: "project"
          
          group_assignments:
            - group_name: "ProdEngineering"
              role_name: "ProdEngineer"
              project_match:
                name_pattern: "^prod-.*"
              enabled: true
              priority: 10
            
            - group_name: "ProdAdmins"
              role_name: "ProdAdmin"
              project_match:
                all_projects: true
              enabled: true
              priority: 100
          
          auto_create_roles: true
          update_existing_roles: true
          remove_unmanaged_acls: false
          dry_run: false
      
      # Development org - more permissive
      - braintrust_org: "development"
        enabled: true
        role_project_config:
          standard_roles:
            - name: "DevEngineer"
              description: "Development engineer with broad permissions"
              member_permissions:
                - permission: "create"
                  restrict_object_type: null
                - permission: "read"
                  restrict_object_type: null
                - permission: "update"
                  restrict_object_type: null
                - permission: "delete"
                  restrict_object_type: null
          
          group_assignments:
            - group_name: "Engineering"
              role_name: "DevEngineer"
              project_match:
                all_projects: true
                exclude_patterns: [".*-sensitive$"]
              enabled: true
              priority: 10
          
          auto_create_roles: true
          update_existing_roles: true
          remove_unmanaged_acls: false
          dry_run: false

# ---------------------------------------------------------------------
# EXAMPLE 4: Team-Based Project Access
# ---------------------------------------------------------------------
# Organize access by team structure and project ownership
team_based_access:
  role_project_assignment:
    global_config:
      # Define roles for different team functions
      standard_roles:
        - name: "TeamLead"
          description: "Team leadership with project management capabilities"
          member_permissions:
            - permission: "create"
              restrict_object_type: null
            - permission: "read"
              restrict_object_type: null
            - permission: "update"
              restrict_object_type: null
            - permission: "delete"
              restrict_object_type: null
            - permission: "create_acls"
              restrict_object_type: "project"
            - permission: "read_acls"
              restrict_object_type: "project"
            - permission: "update_acls"
              restrict_object_type: "project"
        
        - name: "TeamMember"
          description: "Team member with standard development access"
          member_permissions:
            - permission: "read"
              restrict_object_type: null
            - permission: "create"
              restrict_object_type: "experiment"
            - permission: "create"
              restrict_object_type: "dataset"
            - permission: "update"
              restrict_object_type: "experiment"
            - permission: "update"
              restrict_object_type: "dataset"
        
        - name: "Contractor"
          description: "External contractor with limited access"
          member_permissions:
            - permission: "read"
              restrict_object_type: null
            - permission: "create"
              restrict_object_type: "experiment"
      
      auto_create_roles: true
      update_existing_roles: false
      
      group_assignments:
        # AI/ML Team access
        - group_name: "AI-ML-Leads"
          role_name: "TeamLead"
          project_match:
            name_pattern: "^(ai|ml|nlp|cv)[-_].*"
          enabled: true
          priority: 20
        
        - group_name: "AI-ML-Engineers"
          role_name: "TeamMember"
          project_match:
            name_pattern: "^(ai|ml|nlp|cv)[-_].*"
          enabled: true
          priority: 10
        
        # Data Platform Team access
        - group_name: "DataPlatform-Leads"
          role_name: "TeamLead"
          project_match:
            name_contains: ["data-platform", "infrastructure", "pipeline"]
          enabled: true
          priority: 20
        
        - group_name: "DataPlatform-Engineers"
          role_name: "TeamMember"
          project_match:
            name_contains: ["data-platform", "infrastructure", "pipeline"]
          enabled: true
          priority: 10
        
        # Research Team access
        - group_name: "Research-Scientists"
          role_name: "TeamMember"
          project_match:
            name_starts_with: "research-"
          enabled: true
          priority: 10
        
        # External contractors - limited access
        - group_name: "ExternalContractors"
          role_name: "Contractor"
          project_match:
            name_contains: ["public", "external", "demo"]
          enabled: true
          priority: 5
      
      remove_unmanaged_acls: false
      dry_run: false

# ---------------------------------------------------------------------
# EXAMPLE 5: Project Lifecycle Management
# ---------------------------------------------------------------------
# Different access patterns based on project lifecycle stages
lifecycle_management:
  role_project_assignment:
    global_config:
      standard_roles:
        - name: "Researcher"
          description: "Research phase permissions"
          member_permissions:
            - permission: "create"
              restrict_object_type: null
            - permission: "read"
              restrict_object_type: null
            - permission: "update"
              restrict_object_type: null
            - permission: "delete"
              restrict_object_type: "experiment"
            - permission: "delete"
              restrict_object_type: "dataset"
        
        - name: "Developer"
          description: "Development phase permissions"
          member_permissions:
            - permission: "read"
              restrict_object_type: null
            - permission: "create"
              restrict_object_type: "experiment"
            - permission: "update"
              restrict_object_type: "experiment"
        
        - name: "ProductionEngineer"
          description: "Production deployment permissions"
          member_permissions:
            - permission: "read"
              restrict_object_type: null
            - permission: "update"
              restrict_object_type: "experiment"
        
        - name: "Maintainer"
          description: "Long-term maintenance permissions"
          member_permissions:
            - permission: "read"
              restrict_object_type: null
            - permission: "update"
              restrict_object_type: "experiment"
            - permission: "create_acls"
              restrict_object_type: "project"
      
      auto_create_roles: true
      update_existing_roles: true
      
      group_assignments:
        # Research phase projects
        - group_name: "ResearchTeam"
          role_name: "Researcher"
          project_match:
            name_pattern: "^research-.*|.*-research$|.*-poc$"
          enabled: true
          priority: 10
        
        # Development phase projects
        - group_name: "DevelopmentTeam"
          role_name: "Developer"
          project_match:
            name_pattern: "^dev-.*|.*-dev$|.*-prototype$"
          enabled: true
          priority: 10
        
        # Production projects
        - group_name: "ProductionTeam"
          role_name: "ProductionEngineer"
          project_match:
            name_pattern: "^prod-.*|.*-prod$|.*-production$"
          enabled: true
          priority: 15
        
        # Maintenance phase (archived/legacy projects)
        - group_name: "MaintenanceTeam"
          role_name: "Maintainer"
          project_match:
            name_pattern: ".*-legacy$|.*-archive$|.*-deprecated$"
          enabled: true
          priority: 5
      
      remove_unmanaged_acls: false
      dry_run: false

# ---------------------------------------------------------------------
# EXAMPLE 6: Security-Focused Configuration
# ---------------------------------------------------------------------
# Enhanced security with principle of least privilege
security_focused:
  role_project_assignment:
    global_config:
      standard_roles:
        # Minimal base role
        - name: "ReadOnly"
          description: "Read-only access with no modification capabilities"
          member_permissions:
            - permission: "read"
              restrict_object_type: null
        
        # Experiment-only role
        - name: "ExperimentUser"
          description: "Can only work with experiments"
          member_permissions:
            - permission: "read"
              restrict_object_type: null
            - permission: "create"
              restrict_object_type: "experiment"
            - permission: "update"
              restrict_object_type: "experiment"
        
        # Data-only role
        - name: "DataManager"
          description: "Can only work with datasets"
          member_permissions:
            - permission: "read"
              restrict_object_type: null
            - permission: "create"
              restrict_object_type: "dataset"
            - permission: "update"
              restrict_object_type: "dataset"
            - permission: "delete"
              restrict_object_type: "dataset"
        
        # Security administrator
        - name: "SecurityAdmin"
          description: "Security-focused administration"
          member_permissions:
            - permission: "read"
              restrict_object_type: null
            - permission: "read_acls"
              restrict_object_type: null
            - permission: "update_acls"
              restrict_object_type: null
      
      auto_create_roles: true
      update_existing_roles: true
      
      group_assignments:
        # Default minimal access for all users
        - group_name: "AllEmployees"
          role_name: "ReadOnly"
          project_match:
            all_projects: true
            exclude_patterns: [".*-sensitive$", ".*-confidential$"]
          enabled: true
          priority: 1
        
        # Experiment access for data scientists
        - group_name: "DataScientists"
          role_name: "ExperimentUser"
          project_match:
            name_contains: ["experiment", "model", "research"]
            exclude_patterns: [".*-prod$"]
          enabled: true
          priority: 10
        
        # Data management for data engineers
        - group_name: "DataEngineers"
          role_name: "DataManager"
          project_match:
            name_contains: ["data", "etl", "pipeline"]
          enabled: true
          priority: 10
        
        # Security team oversight
        - group_name: "SecurityTeam"
          role_name: "SecurityAdmin"
          project_match:
            all_projects: true
          enabled: true
          priority: 50
      
      # More restrictive settings for security
      remove_unmanaged_acls: true  # Remove any ACLs not in config
      dry_run: false

# ---------------------------------------------------------------------
# EXAMPLE 7: Minimal Configuration
# ---------------------------------------------------------------------
# Simplest possible setup for getting started
minimal_setup:
  role_project_assignment:
    global_config:
      # Use predefined standard roles (imported automatically)
      standard_roles: []  # Will use STANDARD_ROLES from the code
      
      auto_create_roles: true
      update_existing_roles: false
      
      # Simple assignments
      group_assignments:
        - group_name: "Engineers"
          role_name: "Engineer"
          project_match:
            all_projects: true
          enabled: true
          priority: 10
        
        - group_name: "Viewers"
          role_name: "Viewer"
          project_match:
            all_projects: true
          enabled: true
          priority: 5
      
      remove_unmanaged_acls: false
      dry_run: false